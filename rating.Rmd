---
title: "rating"
author: "Alisson"
header-includes:
   - \usepackage[brazil]{babel}
geometry: margin=2cm
output:
  bookdown::html_document2:
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
library('tidyverse')
library("tidymodels")
library('kableExtra')
options(digits=2)
theme_set(theme_minimal())
knitr::opts_chunk$set(echo=FALSE,message=F,warning=F,fig.pos = 'H',fig.align = 'center',fig.width=7.8, fig.height=4.85)
scale_fill_eu <- function(...) {
  ggplot2:::manual_scale(
    "fill",
    values = setNames(
      c("#4711EE", "#383745", "#42B81D", "#E8EE11"), levels(as.factor(data$Tipo)),
      ...
    )
  )
}
scale_fill_discrete <- \(...) scale_fill_eu(...)
```
```{r data }
#----
# DATASET-----
df <- "https://www.animefillerlist.com/shows/one-piece" %>%
  rvest::read_html() %>%
  rvest::html_node(xpath = '//*[@id="node-19"]/div[3]/table') %>%
  rvest::html_table()
#----
Saga <- c(
  rep("East Blue", 61), rep("Alabasta", 74),
  rep("Skypiea", 71), rep("Water 7", 119),
  rep("Thriller Bark", 59), rep("Guerra de Marineford", 132),
  rep("Ilha dos Homens-Peixe", 58), rep("Aliança Pirata", 172),
  rep("Yonkou", nrow(df) + 1 - 747)
)
rate=read_csv("https://raw.githubusercontent.com/AlissonRP/OP_Rating/master/ONE%20PIECE.csv") %>% 
  select(total_votes,average_rating)
df <- df %>%
  .[1:958,] %>% 
  rename(numero_episodio = `#`, Titulo = Title, Tipo = Type) %>%
  bind_cols(Saga= Saga[1:958],rate) %>% 
  separate(Airdate,c("Lançamento")) %>% 
  mutate(Lançamento=as.numeric(Lançamento))
df$Saga <- factor(df$Saga, levels = c("East Blue", "Alabasta", "Skypiea", "Water 7", 
                                          "Thriller Bark", "Guerra de Marineford",
                                          "Ilha dos Homens-Peixe",
                                          "Aliança Pirata","Yonkou"))
#### FUNCTIONS------
scale_fill_eu <- function(...) {
  ggplot2:::manual_scale(
    "fill",
    values = setNames(
      c("#4711EE", "#383745", "#42B81D", "#E8EE11"), levels(as.factor(data$Tipo)),
      ...
    )
  )
}
scale_fill_discrete <- \(...) scale_fill_eu(...)

```

## Introdução

One piece é até o momento   o anime com maior duração (`r max(df$Lançamento)-min(df$Lançamento) +1 ` Anos), inclusive sendo mais velho que o autor vos escreve. Nesse breve ensaio veremos como a obra (anime) se comporta em relação a quantidade de episódios postados por ano, tipos de episódios, e avaliação pelos fãs.

## O Tempo passa e Luffy segue em frente
Veja que são 23 anos de história, e mesmo assim a quantidade de episódios postadas por ano tem pouca variação:
```{r anoep}
plotly::ggplotly(df %>% 
  group_by(Lançamento) %>% 
  summarise(total=n()) %>% 
  ggplot(aes(Lançamento,total))+
  geom_bar(stat="identity"))
```




